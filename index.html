<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ミニノベルゲーム</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel Standalone for JSX transformation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* カスタムスタイル */
    body {
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    // アイコンコンポーネント（SVG）
    const RotateCcw = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
      </svg>
    );

    const Award = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
      </svg>
    );

    const scenarios = [
      {
        id: 1,
        title: '謎の依頼',
        setup: 'あなたは探偵事務所で古い写真を手渡されました。',
        choices: [
          { id: 1, text: '写真の人物について調べる', preview: '私：「この人物は...' },
          { id: 2, text: '写真の背景について調べる', preview: '私：「この建物は...' }
        ],
        branches: {
          1: {
            text: '私：「この人物は10年前に失踪した田中様ですね」\n依頼人：「そう、でも私が知りたいのは・・・」\n私：「失礼しました。【もうひとつ】の手がかりを調べます。背景の建物ですね」\n\n(あなたは何かを見つけた気がした。写真の隅に小さな文字が...「も」)',
            hasWord: true,
            epilogue: 'その後、あなたは背景の手がかりから事件を解決し、一人前の探偵として認められるようになりました。\n(何かが集まり始めている...「も」という文字を手に入れた)',
            epilogue2: 'もも子さんは、あなたの探偵としての成長を認めてくれました。\n「あなたは本当に優秀な探偵ね。また何かあったら、お願いします」\nそう言って、もも子さんは笑顔で帰っていきました。\nあなたは、写真の隅にあった小さな文字「も」を大切に保管することにしました。'
          },
          2: {
            text: '私：「この建物は取り壊された旧市庁舎です」\n依頼人：「まさにそこ!ありがとう、探偵さん」',
            hasWord: false,
            epilogue: '事件は解決しましたが、何か物足りなさを感じました。\n依頼人は満足していましたが、あなたは写真の人物についてもっと調べたかったのです。\n(もしかしたら、もうひとつの手がかりがあったのかもしれない...)',
            hint: '💡 ヒント: もも子さんは「もうひとつ」の手がかりを求めていました。写真の「人物」だけでなく、「背景」にも注目してみましょう。'
          }
        }
      },
      {
        id: 2,
        title: '不思議なレストラン',
        setup: 'メニューには「本日のおすすめ」と「シェフのきまぐれ」があります。',
        choices: [
          { id: 1, text: '本日のおすすめを注文する', preview: 'シェフ：「お待たせ...' },
          { id: 2, text: 'シェフのきまぐれを注文する', preview: 'シェフ：「お待たせ...' }
        ],
        branches: {
          1: {
            text: 'シェフ：「お待たせしました」\n美味しい料理が運ばれてきた。\nシェフ：「お気に召しましたか?」\n私：「はい!」',
            hasWord: false,
            epilogue: '料理は美味しかったですが、シェフの「きまぐれ」が気になりました。\n次回は、きまぐれメニューも試してみようと心に決めました。\n(もしかしたら、あの空の皿には何か意味があったのかもしれない...)',
            hint: '💡 ヒント: うみシェフの「きまぐれ」には特別な意味があります。空の皿の「裏」や「底」に注目してみましょう。'
          },
          2: {
            text: 'シェフ：「お待たせしました」\n運ばれてきたのは空の皿。\n私：「あの・・・これは?」\nシェフ：にっこり笑って「今日のきまぐれは『想像の料理』です」\n私：「・・・?」\nシェフ：「冗談です。【もうひとつ】お持ちします」\n\n(皿の底に何かが刻まれていた...「う」)',
            hasWord: true,
            epilogue: 'シェフのユーモアに笑いながら、あなたはこのレストランの常連客になりました。\n(また文字を手に入れた...「う」)',
            epilogue2: 'うみシェフは、あなたが皿の底の文字に気づいたことを喜んでいました。\n「よく気づいてくれたわね。あれは特別なお客様へのメッセージなの」\nあなたは、うみシェフの遊び心と温かさに、ますますこのレストランが好きになりました。\n「また来てね」と、うみシェフは手を振って見送ってくれました。'
          }
        }
      },
      {
        id: 3,
        title: 'タイムカプセル',
        setup: '20年前に埋めたタイムカプセルを掘り起こす日がきました。',
        choices: [
          { id: 1, text: '一人で開ける', preview: '中には手紙と壊れた...' },
          { id: 2, text: '幼馴染を呼んで一緒に開ける', preview: '友：「開けよう!」...' }
        ],
        branches: {
          1: {
            text: '中には手紙と壊れたキーホルダーが入っていた。\n手紙：「未来の僕へ。夢は叶った?」\n胸が締め付けられる。\n(あいつと一緒に埋めたのに・・・)',
            hasWord: false,
            epilogue: '一人でタイムカプセルを開けた後、後悔の念に襲われました。\n幼馴染を呼べば良かった...そう思うと、胸が痛みました。\n(もしかしたら、一緒に開けていれば、違う何かが見つかったかもしれない)',
            hint: '💡 ヒント: ひろは「もうひとつ」の手紙を入れていたと言っていました。一緒に開けることで、手紙の「裏」に何か見つかるかもしれません。'
          },
          2: {
            text: '友：「開けよう!」\n中には手紙が二通。\n私：「あれ、一通しか入れてないよね?」\n友：ニヤリと笑って「実は僕も【もうひとつ】入れてたんだ。読んでみて」\n手紙には励ましの言葉が綴られていた。\n\n(手紙の裏に小さな文字が...「ひ」)',
            hasWord: true,
            epilogue: '幼馴染との絆を再確認したあなたは、二人で新しいタイムカプセルを埋めることにしました。\n(3つ目の文字を発見...「ひ」)',
            epilogue2: '新しいタイムカプセルを埋めた後、ひろは「今度は20年後、また一緒に開けよう」と言いました。\n「約束だよ」と、あなたはひろと小指を絡めました。\n手紙の裏にあった文字「ひ」は、友情の証として、あなたの心に刻まれました。\n二人は、これからもずっと友達でいられることを確信しました。'
          }
        }
      },
      {
        id: 4,
        title: '魔法学校の試験',
        setup: '試験官：「ウサギを出現させなさい」',
        choices: [
          { id: 1, text: '呪文を唱える', preview: 'パッ!ウサギが2...' },
          { id: 2, text: '帽子から取り出す', preview: 'スッと帽子からウサ...' }
        ],
        branches: {
          1: {
            text: 'パッ!ウサギが2羽出現した。\n試験官：「おや?」\n私：「すみません、魔力が強すぎて・・・」\n試験官：「構いません。では【もうひとつ】消してください」\n私：冷や汗をかく。\n\n(消えたウサギの跡に文字が浮かんだ...「と」)',
            hasWord: true,
            epilogue: 'あなたは魔法と手品の両方をマスターし、誰もが驚くエンターテイナーになりました。\n(4つ目の文字を手に入れた...「と」)',
            epilogue2: 'とおる試験官は、あなたの才能を高く評価してくれました。\n「魔法と手品、両方を使えるのは珍しい。君は特別な才能を持っている」\nあなたは、消えたウサギの跡に浮かんだ文字「と」を、魔法の証として大切にしました。\n「これからも、もうひとつの可能性を探し続けてほしい」と、とおる試験官は言いました。'
          },
          2: {
            text: 'スッと帽子からウサギを取り出した。\n試験官：「完璧です。合格」\n試験が終わってから気づいた。\n(あれ、魔法使ってないぞ?)',
            hasWord: false,
            epilogue: '試験には合格しましたが、手品でごまかしたことに罪悪感を覚えました。\n本当の魔法を習得するため、あなたは再び魔法学校の門を叩くことにしました。\n(もしかしたら、呪文を唱えていれば、何か特別なことが起きたかもしれない)',
            hint: '💡 ヒント: とおる試験官は「もうひとつ」消すよう指示しました。呪文を唱えて、ウサギが「もうひとつ」出現した時、何か特別なことが起きるかもしれません。'
          }
        }
      },
      {
        id: 5,
        title: '最後のピース',
        setup: '1000ピースのジグソーパズルがあと1ピースで完成します。',
        choices: [
          { id: 1, text: '最後のピースをはめる', preview: 'カチッ。完成した絵は...' },
          { id: 2, text: '周りを探してみる', preview: '床を這いつくばって探...' }
        ],
        branches: {
          1: {
            text: 'カチッ。完成した絵は美しい星空。\n達成感に満たされる。\nその時、床に何かが落ちているのに気づいた。\n(え・・・まさか)',
            hasWord: false,
            epilogue: 'パズルは完成しましたが、床に落ちていたのは別のピースでした。\nもしかしたら、周りをもっと探していれば、恋人のサプライズに気づけたかもしれません。\n(次は、もっと注意深く観察しようと心に誓いました)',
            hint: '💡 ヒント: つばさは「もうひとつ」のパズルを用意していました。周りを探すことで、つばさのサプライズに気づけるかもしれません。箱の「蓋の内側」にも注目してみましょう。'
          },
          2: {
            text: '床を這いつくばって探す。見つからない。\n恋人：「探し物?」\n私：「最後のピースが・・・」\n恋人：ポケットから取り出して「実は【もうひとつ】買っておいたんだ。君が完成させた時のために」\n箱には同じパズルが入っていた。\n\n(箱の蓋の内側に文字が...「つ」)',
            hasWord: true,
            epilogue: '恋人の優しさに感動したあなたは、二人で新しいパズルを完成させながら幸せな時間を過ごしました。\n(最後の文字を手に入れた...「つ」)',
            epilogue2: '新しいパズルを完成させた後、つばさは「君のために、いつも準備してるんだよ」と微笑みました。\n箱の蓋の内側にあった文字「つ」は、つばさの愛情の証でした。\n「これからも、ずっと一緒にパズルを完成させようね」\nあなたは、つばさの優しさに包まれながら、幸せを噛みしめました。'
          }
        }
      },
      {
        id: 6,
        title: '真実の扉',
        setup: '5つの「もうひとつ」を集めたあなたの前に、古びた扉が現れました。\n扉には「もうひとつ」という文字が刻まれています。\n謎の声が響きます：「なぜ、あなたは『もうひとつ』を探し続けたのか？」',
        choices: [
          { id: 1, text: '「好奇心からです」と答える', preview: '私：「ただ、気になっただけ...' },
          { id: 2, text: '「答えを知りたかったからです」と答える', preview: '声：「では、その答えを...' }
        ],
        branches: {
          1: {
            text: '私：「ただ、気になっただけです」\n声：「なるほど...では、その好奇心があなたをここへ導いたのですね」\n扉がゆっくりと開く。\n中から光が溢れ出し、あなたの前に現れたのは...\n\n声：「実は、『もうひとつ』を探すことは、人生の縮図なのです」\n「いつも、もうひとつの選択肢、もうひとつの可能性、もうひとつの答えがある」\n「それを探し続けることが、成長への鍵なのです」\n\nあなたは深く頷いた。',
            hasWord: false,
            epilogue: '好奇心から始まった旅路でしたが、真実の一部しか見ることができませんでした。\nもしかしたら、「答えを知りたかった」と答えることで、もっと深い真実に辿り着けたかもしれません。\nそれでも、あなたは「もうひとつ」を探し続けることの大切さを学びました。'
          },
          2: {
            text: '声：「では、その答えを教えましょう」\n扉が大きく開く。\n\n声：「あなたが集めたもの...それは何だったか覚えていますか?」\nあなたは手を伸ばす。集めた文字が浮かび上がる...\n\n「も」「う」「ひ」「と」「つ」\n\n声：「そう、『もうひとつ』です」\n「あなたは5つの物語を通じて、この言葉を集めました」\n「なぜ『もうひとつ』を探す必要があったのか...」\n「それは、あなた自身が『もうひとつ』の存在だからです」\n「この世界には、あなたという『もうひとつ』の可能性が必要だった」\n「選択肢が2つある時、常に『もうひとつ』の道を探すこと」\n「それが、あなたを特別な存在にするのです」\n\n光に包まれながら、あなたは全てを理解した。\n集めた文字が「もうひとつ」という言葉として輝いた。\nそして、扉の向こうには新しい世界が広がっていた。',
            hasWord: true,
            epilogue: '「もうひとつ」の真実を知ったあなたは、これからも常に新しい可能性を探し続けることを誓いました。\n\n(あなたが集めた文字「も」「う」「ひ」「と」「つ」は、\n「もうひとつ」という言葉として、あなたの心に刻まれました)'
          }
        }
      }
    ];

    function MiniNovelGame() {
      const [currentScenario, setCurrentScenario] = useState(null);
      const [gameState, setGameState] = useState('selection');
      const [selectedChoice, setSelectedChoice] = useState(null);
      const [score, setScore] = useState(0);
      const [completedScenarios, setCompletedScenarios] = useState(new Set());
      const [scenarioResults, setScenarioResults] = useState({}); // 各シナリオの結果を保存 {scenarioId: {hasWord: bool, choiceId: number, epilogue: string}}
      const [collectedLetters, setCollectedLetters] = useState(new Set()); // 集めた文字を保存
      const [showHint, setShowHint] = useState(false); // ヒントの表示/非表示
      const [expandedProfiles, setExpandedProfiles] = useState(new Set()); // 後日談の後日談を展開しているプロフィール
      const [showCredits, setShowCredits] = useState(false); // エンドクレジットの表示/非表示

      const handleScenarioSelect = (scenarioId) => {
        const scenarioIndex = scenarios.findIndex(s => s.id === scenarioId);
        setCurrentScenario(scenarioIndex);
        setGameState('setup');
        setSelectedChoice(null);
      };

      const handleChoice = (choiceId) => {
        setSelectedChoice(choiceId);
        const branch = scenarios[currentScenario].branches[choiceId];
        const scenarioId = scenarios[currentScenario].id;
        
        const epilogue = branch.epilogue || scenarios[currentScenario].epilogue;
        const currentScore = branch.hasWord ? score + 1 : score;
        
        if (branch.hasWord) {
          const newScore = score + 1;
          setScore(newScore);
          setCompletedScenarios(new Set([...completedScenarios, scenarioId]));
          setScenarioResults({
            ...scenarioResults,
            [scenarioId]: { hasWord: true, choiceId: choiceId, epilogue: epilogue, scoreAtCompletion: newScore }
          });
          
          // 文字を収集（シナリオ1-5のみ）
          if (scenarioId <= 5) {
            const letters = ['も', 'う', 'ひ', 'と', 'つ'];
            const letterIndex = scenarioId - 1;
            if (letterIndex < letters.length) {
              setCollectedLetters(new Set([...collectedLetters, letters[letterIndex]]));
            }
          }
        } else {
          setScenarioResults({
            ...scenarioResults,
            [scenarioId]: { hasWord: false, choiceId: choiceId, epilogue: epilogue, scoreAtCompletion: currentScore }
          });
        }
        
        setGameState('result');
      };

      const backToSelection = () => {
        setGameState('selection');
        setCurrentScenario(null);
        setSelectedChoice(null);
      };

      const reset = () => {
        setCurrentScenario(null);
        setGameState('selection');
        setSelectedChoice(null);
        setScore(0);
        setCompletedScenarios(new Set());
        setScenarioResults({});
        setCollectedLetters(new Set());
        setShowHint(false);
        setExpandedProfiles(new Set());
        setShowCredits(false);
      };

      // エンドクレジット画面
      if (showCredits) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4">
            <div className="bg-black/80 backdrop-blur rounded-2xl shadow-2xl p-12 max-w-3xl w-full text-center text-white">
              <h1 className="text-5xl font-bold mb-12 animate-pulse">「もうひとつ」</h1>
              
              <div className="space-y-8 text-lg">
                <div>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">ゲームデザイン</p>
                  <p className="text-xl">tatmos</p>
                </div>
                
                <div>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">AIディレクション</p>
                  <p className="text-xl">tatmos</p>
                </div>
                
                <div>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">シナリオ</p>
                  <p className="text-xl">Claude sonnet 4.5</p>
                </div>
                
                <div>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">リードプログラマ</p>
                  <p className="text-xl">Claude sonnet 4.5</p>
                </div>
                
                <div>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">プログラマ</p>
                  <p className="text-xl">tatmos</p>
                </div>
                
                <div>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">音楽</p>
                  <p className="text-xl">tatmos</p>
                </div>
                
                <div>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">効果音</p>
                  <p className="text-xl">tatmos</p>
                </div>
                
                <div>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">グラフィック</p>
                  <p className="text-xl">Chat GPT 5.2</p>
                </div>
                
                <div className="mt-12 pt-8 border-t border-white/30">
                  <p className="text-3xl font-bold mb-6 text-yellow-300">エンドクレジット楽曲</p>
                  <p className="text-2xl font-bold mb-4">曲：「もうひとつ」 / 作曲：suno ai v5 / 作詞：Claude sonnet 4.5</p>
                <div>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">歌：suno ai v5</p>
                </div>
                <div>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">演奏：suno ai v5</p>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">ミキシング：suno ai v5</p>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">マスタリング：suno ai v5</p>
                  <p className="text-2xl font-bold mb-4 text-yellow-300">サウンドエンジニア：tatmos</p>
                </div>
                </div>
              </div>
              
              <button
                onClick={() => setShowCredits(false)}
                className="mt-12 bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105"
              >
                閉じる
              </button>
            </div>
          </div>
        );
      }

      // 選択画面
      if (gameState === 'selection') {
        const totalCompleted = completedScenarios.size;
        const isDarkMode = score > scenarios.length;
        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center p-4">
            <div className="bg-white/90 backdrop-blur rounded-2xl shadow-2xl p-8 max-w-4xl w-full">
              <div className="text-center mb-8">
                <h1 className="text-4xl font-bold text-gray-800 mb-2">ミニノベルゲーム</h1>
                <p className="text-lg text-gray-600 mb-4">
                  【もうひとつ】ワードゲット数: {score} / {scenarios.length}
                  {score > scenarios.length && <span className="text-red-500 font-bold ml-2">（おや？）</span>}
                </p>
                <p className="text-sm text-gray-500">シナリオを選択してください</p>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {scenarios.map((scenario) => {
                  // 6番目のシナリオは最初の5つをクリアするまで表示しない
                  const firstFiveCompleted = scenarios.filter(s => s.id <= 5).every(s => completedScenarios.has(s.id));
                  if (scenario.id === 6 && !firstFiveCompleted) {
                    return null;
                  }
                  
                  const isCompleted = completedScenarios.has(scenario.id);
                  const result = scenarioResults[scenario.id];
                  const isLocked = scenario.id === 6 && !firstFiveCompleted;
                  
                  return (
                    <button
                      key={scenario.id}
                      onClick={() => !isLocked && handleScenarioSelect(scenario.id)}
                      disabled={isLocked}
                      className={`relative p-6 rounded-lg transition-all transform hover:scale-105 text-left ${
                        isLocked
                          ? 'bg-gray-400 cursor-not-allowed opacity-50'
                          : isCompleted
                          ? 'bg-gradient-to-br from-green-500 to-emerald-600 text-white'
                          : 'bg-gradient-to-br from-purple-500 to-blue-500 text-white hover:from-purple-600 hover:to-blue-600'
                      }`}
                    >
                      <div className="font-bold text-xl mb-2">
                        {scenario.title}
                        {scenario.id === 6 && firstFiveCompleted && (
                          <span className={`ml-2 text-sm ${isDarkMode ? 'text-red-300' : 'text-yellow-300'}`}>
                            {isDarkMode ? '⚠️ ダークモード' : '✨ 新規追加'}
                          </span>
                        )}
                      </div>
                      <div className="text-sm opacity-90 line-clamp-2">
                        {isLocked 
                          ? '最初の5つのシナリオをクリアすると出現します' 
                          : (scenario.id === 6 && isDarkMode 
                            ? '【システムエラー】異常なスコアを検出。世界の整合性が崩壊しています...'
                            : scenario.setup)}
                      </div>
                      {isCompleted && (
                        <div className="absolute top-2 right-2">
                          <Award className="w-6 h-6 text-yellow-300" />
                        </div>
                      )}
                      {result && !result.hasWord && (
                        <div className="absolute top-2 right-2">
                          <span className="text-xs bg-white/30 px-2 py-1 rounded">未獲得</span>
                        </div>
                      )}
                      {isLocked && (
                        <div className="absolute top-2 right-2">
                          <span className="text-xs bg-white/30 px-2 py-1 rounded">🔒 ロック</span>
                        </div>
                      )}
                    </button>
                  );
                })}
              </div>

              {totalCompleted === scenarios.length && (
                <div className="mt-8 text-center">
                  {isDarkMode ? (
                    <div className="bg-red-900 border-2 border-red-600 rounded-lg p-4 inline-block relative overflow-hidden">
                      <div className="absolute inset-0 bg-red-500 opacity-20 animate-pulse"></div>
                      <p className="text-red-200 font-bold text-lg relative z-10 transform rotate-1" style={{textShadow: '2px 2px 4px rgba(0,0,0,0.5)'}}>
                        ⚠️ 【エラー】全シナリオクリア...？ ⚠️
                      </p>
                      <p className="text-red-300 text-xs mt-2 relative z-10" style={{fontFamily: 'monospace'}}>
                        [SYSTEM_ERROR] Completion status: CORRUPTED
                      </p>
                      <p className="text-red-400 text-xs mt-1 relative z-10 animate-pulse">
                        ？全シナリオクリア！？全シナリオクリア！？全シナリオクリア！？
                      </p>
                    </div>
                  ) : (
                    <div className="bg-yellow-100 border-2 border-yellow-500 rounded-lg p-4 inline-block">
                      <p className="text-yellow-800 font-bold text-lg">
                        🎉 全シナリオクリア！ 🎉
                      </p>
                    </div>
                  )}
                </div>
              )}
              
              {scenarios.filter(s => s.id <= 5).every(s => completedScenarios.has(s.id)) && !completedScenarios.has(6) && (
                <div className="mt-8 text-center">
                  <div className="bg-purple-100 border-2 border-purple-500 rounded-lg p-4 inline-block animate-pulse">
                    <p className="text-purple-800 font-bold text-lg">
                      ✨ 新しいシナリオが出現しました！ ✨
                    </p>
                  </div>
                </div>
              )}

              {/* 登場人物プロフィール */}
              <div className="mt-12 pt-8 border-t-2 border-gray-300">
                <h2 className={`text-2xl font-bold mb-6 text-center ${isDarkMode ? 'text-red-800' : 'text-gray-800'}`}>
                  {isDarkMode ? '登場人物プロフィール【データ破損】' : '登場人物プロフィール'}
                </h2>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {/* シナリオ1: も */}
                  {(() => {
                    const isUnlocked = scenarioResults[1] !== undefined;
                    const result = scenarioResults[1];
                    const scenario = scenarios.find(s => s.id === 1);
                    const isExpanded = expandedProfiles.has(1);
                    return (
                      <div className={`bg-gradient-to-br from-pink-50 to-rose-50 rounded-lg p-4 border-2 ${isUnlocked ? 'border-pink-200' : 'border-gray-300'} relative ${!isUnlocked ? 'opacity-60' : ''}`}>
                        {!isUnlocked && (
                          <div className="absolute inset-0 bg-gray-200 bg-opacity-50 rounded-lg flex items-center justify-center backdrop-blur-sm">
                            <span className="text-gray-500 font-bold text-lg">???</span>
                          </div>
                        )}
                        <h3 className="font-bold text-lg text-gray-800 mb-2">
                          {isUnlocked ? '田中 もも子（依頼人）' : '???（依頼人）'}
                        </h3>
                        {isUnlocked ? (
                          <>
                            <p className={`text-sm mb-2 ${isDarkMode ? 'text-red-900' : 'text-gray-700'}`}>
                              <span className="font-semibold">職業:</span> {isDarkMode ? '【データ欠損】' : '会社員'}<br/>
                              <span className="font-semibold">特徴:</span> {isDarkMode 
                                ? 'バグによって「も」という文字を失った。写真は歪み、人物の姿が消えている。データの欠片となって崩壊しつつある。'
                                : '10年前に失踪した人物の写真を持参。探偵に「もうひとつ」の手がかりを求めている。写真の隅に何か隠されているかもしれない。'}
                              {scenarioResults[6] && !isDarkMode && (
                                <><br/><br/><span className="font-semibold text-pink-700">謎の声との関係:</span> もも子さんが探していた「もうひとつ」は、実は謎の声が導いた道標でした。謎の声は、もも子さんに真実を見つける力を与えた存在です。
                                </>)}
                              {scenarioResults[6] && isDarkMode && (
                                <><br/><br/><span className="font-semibold text-red-700">【バグ】:</span> もも子のデータは破損しています。「も」という文字が消失し、存在が不安定になっています。シミュレーションの整合性が崩壊しています。
                                </>)}
                            </p>
                            <p className={`text-xs italic mb-3 ${isDarkMode ? 'text-red-700' : 'text-pink-600'}`}>
                              {isDarkMode ? '「も...も...もど...」【エラー】' : '「もっと深く調べてほしいの...」'}
                            </p>
                            {result && (
                              <>
                                <div className={`mt-3 pt-3 border-t ${isDarkMode ? 'border-red-600 bg-red-900' : 'border-pink-200'}`}>
                                  <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-red-200' : 'text-pink-700'}`}>後日談</p>
                                  <p className={`text-xs whitespace-pre-line ${isDarkMode ? 'text-red-100' : 'text-gray-600'}`}>
                                    {isDarkMode 
                                      ? '【データ破損】\nもも子のデータは完全に崩壊しました。写真は歪み、人物の姿は消えています。\n「も」という文字を失ったもも子は、存在そのものが不安定になっています。\nシミュレーションの整合性が崩壊し、修復不可能な状態です。'
                                      : result.epilogue}
                                  </p>
                                </div>
                                {result.hasWord && scenario && scenario.branches[result.choiceId] && scenario.branches[result.choiceId].epilogue2 && (
                                  <>
                                    <button
                                      onClick={() => {
                                        const newExpanded = new Set(expandedProfiles);
                                        if (isExpanded) {
                                          newExpanded.delete(1);
                                        } else {
                                          newExpanded.add(1);
                                        }
                                        setExpandedProfiles(newExpanded);
                                      }}
                                      className="mt-2 text-xs text-pink-600 hover:text-pink-800 underline"
                                    >
                                      {isExpanded ? '▼ 後日談の後日談を隠す' : '▶ 後日談の後日談を見る'}
                                    </button>
                                    {isExpanded && (
                                      <div className={`mt-2 pt-2 border-t ${isDarkMode ? 'border-red-700 bg-red-950' : 'border-pink-100'}`}>
                                        <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-red-300' : 'text-pink-600'}`}>後日談の後日談</p>
                                        <p className={`text-xs whitespace-pre-line ${isDarkMode ? 'text-red-200' : 'text-gray-600'}`}>
                                          {isDarkMode 
                                            ? '【完全崩壊】\nもも子は完全にデータの欠片となって消えました。\n写真は歪み、人物の姿は完全に消失しています。\n「も」という文字を失ったもも子は、もう存在しません。\nシミュレーションの整合性は完全に崩壊し、修復不可能です。\n\nあなたは、もも子を失った世界に一人取り残されました。'
                                            : scenario.branches[result.choiceId].epilogue2}
                                        </p>
                                      </div>
                                    )}
                                  </>
                                )}
                                {!result.hasWord && scenario && scenario.branches[result.choiceId] && scenario.branches[result.choiceId].hint && (
                                  <div className="mt-3 pt-3 border-t border-pink-200 bg-pink-50 rounded p-2">
                                    <p className="text-xs text-pink-700 whitespace-pre-line">{scenario.branches[result.choiceId].hint}</p>
                                  </div>
                                )}
                              </>
                            )}
                          </>
                        ) : (
                          <p className="text-sm text-gray-500 italic">シナリオ「謎の依頼」をクリアすると表示されます</p>
                        )}
                      </div>
                    );
                  })()}

                  {/* シナリオ2: う */}
                  {(() => {
                    const isUnlocked = scenarioResults[2] !== undefined;
                    const result = scenarioResults[2];
                    const scenario = scenarios.find(s => s.id === 2);
                    const isExpanded = expandedProfiles.has(2);
                    return (
                      <div className={`bg-gradient-to-br from-blue-50 to-cyan-50 rounded-lg p-4 border-2 ${isUnlocked ? 'border-blue-200' : 'border-gray-300'} relative ${!isUnlocked ? 'opacity-60' : ''}`}>
                        {!isUnlocked && (
                          <div className="absolute inset-0 bg-gray-200 bg-opacity-50 rounded-lg flex items-center justify-center backdrop-blur-sm">
                            <span className="text-gray-500 font-bold text-lg">???</span>
                          </div>
                        )}
                        <h3 className="font-bold text-lg text-gray-800 mb-2">
                          {isUnlocked ? '海原 うみ（シェフ）' : '???（シェフ）'}
                        </h3>
                        {isUnlocked ? (
                          <>
                            <p className={`text-sm mb-2 ${isDarkMode ? 'text-red-900' : 'text-gray-700'}`}>
                              <span className="font-semibold">職業:</span> {isDarkMode ? '【データ欠損】' : 'レストランシェフ'}<br/>
                              <span className="font-semibold">特徴:</span> {isDarkMode 
                                ? 'バグによって「う」という文字を失った。皿は空のまま、料理は生成されない。ユーモアは歪み、恐怖に変わっている。'
                                : 'ユーモア好きで、時々「きまぐれ」なメニューを提供。空の皿を出すこともあるが、その裏には何か意味があるかもしれない。'}
                              {scenarioResults[6] && !isDarkMode && (
                                <><br/><br/><span className="font-semibold text-blue-700">謎の声との関係:</span> うみシェフの「きまぐれ」は、謎の声からのメッセージでした。謎の声は、うみシェフを通じて「もうひとつ」の楽しみを伝えようとしていたのです。
                                </>)}
                              {scenarioResults[6] && isDarkMode && (
                                <><br/><br/><span className="font-semibold text-red-700">【バグ】:</span> うみのデータは破損しています。「う」という文字が消失し、皿からは何も生成されません。シミュレーションの物理法則が崩壊しています。
                                </>)}
                            </p>
                            <p className={`text-xs italic mb-3 ${isDarkMode ? 'text-red-700' : 'text-blue-600'}`}>
                              {isDarkMode ? '「う...う...うま...」【エラー】' : '「お客様には、もうひとつの楽しみを...」'}
                            </p>
                            {result && (
                              <>
                                <div className={`mt-3 pt-3 border-t ${isDarkMode ? 'border-red-600 bg-red-900' : 'border-blue-200'}`}>
                                  <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-red-200' : 'text-blue-700'}`}>後日談</p>
                                  <p className={`text-xs whitespace-pre-line ${isDarkMode ? 'text-red-100' : 'text-gray-600'}`}>
                                    {isDarkMode 
                                      ? '【データ破損】\nうみのデータは完全に崩壊しました。皿からは何も生成されず、レストランは空っぽです。\n「う」という文字を失ったうみは、ユーモアを失い、恐怖に変わっています。\nシミュレーションの物理法則が崩壊しています。'
                                      : result.epilogue}
                                  </p>
                                </div>
                                {result.hasWord && scenario && scenario.branches[result.choiceId] && scenario.branches[result.choiceId].epilogue2 && (
                                  <>
                                    <button
                                      onClick={() => {
                                        const newExpanded = new Set(expandedProfiles);
                                        if (isExpanded) {
                                          newExpanded.delete(2);
                                        } else {
                                          newExpanded.add(2);
                                        }
                                        setExpandedProfiles(newExpanded);
                                      }}
                                      className="mt-2 text-xs text-blue-600 hover:text-blue-800 underline"
                                    >
                                      {isExpanded ? '▼ 後日談の後日談を隠す' : '▶ 後日談の後日談を見る'}
                                    </button>
                                    {isExpanded && (
                                      <div className={`mt-2 pt-2 border-t ${isDarkMode ? 'border-red-700 bg-red-950' : 'border-blue-100'}`}>
                                        <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-red-300' : 'text-blue-600'}`}>後日談の後日談</p>
                                        <p className={`text-xs whitespace-pre-line ${isDarkMode ? 'text-red-200' : 'text-gray-600'}`}>
                                          {isDarkMode 
                                            ? '【完全崩壊】\nうみは完全にデータの欠片となって消えました。\n皿からは何も生成されず、レストランは空っぽです。\n「う」という文字を失ったうみは、もう存在しません。\nシミュレーションの物理法則は完全に崩壊し、修復不可能です。\n\nあなたは、うみを失った世界に一人取り残されました。'
                                            : scenario.branches[result.choiceId].epilogue2}
                                        </p>
                                      </div>
                                    )}
                                  </>
                                )}
                                {!result.hasWord && scenario && scenario.branches[result.choiceId] && scenario.branches[result.choiceId].hint && (
                                  <div className="mt-3 pt-3 border-t border-blue-200 bg-blue-50 rounded p-2">
                                    <p className="text-xs text-blue-700 whitespace-pre-line">{scenario.branches[result.choiceId].hint}</p>
                                  </div>
                                )}
                              </>
                            )}
                          </>
                        ) : (
                          <p className="text-sm text-gray-500 italic">シナリオ「不思議なレストラン」をクリアすると表示されます</p>
                        )}
                      </div>
                    );
                  })()}

                  {/* シナリオ3: ひ */}
                  {(() => {
                    const isUnlocked = scenarioResults[3] !== undefined;
                    const result = scenarioResults[3];
                    const scenario = scenarios.find(s => s.id === 3);
                    const isExpanded = expandedProfiles.has(3);
                    return (
                      <div className={`bg-gradient-to-br from-yellow-50 to-amber-50 rounded-lg p-4 border-2 ${isUnlocked ? 'border-yellow-200' : 'border-gray-300'} relative ${!isUnlocked ? 'opacity-60' : ''}`}>
                        {!isUnlocked && (
                          <div className="absolute inset-0 bg-gray-200 bg-opacity-50 rounded-lg flex items-center justify-center backdrop-blur-sm">
                            <span className="text-gray-500 font-bold text-lg">???</span>
                          </div>
                        )}
                        <h3 className="font-bold text-lg text-gray-800 mb-2">
                          {isUnlocked ? '広瀬 ひろ（幼馴染）' : '???（幼馴染）'}
                        </h3>
                        {isUnlocked ? (
                          <>
                            <p className={`text-sm mb-2 ${isDarkMode ? 'text-red-900' : 'text-gray-700'}`}>
                              <span className="font-semibold">職業:</span> {isDarkMode ? '【データ欠損】' : 'フリーランス'}<br/>
                              <span className="font-semibold">特徴:</span> {isDarkMode 
                                ? 'バグによって「ひ」という文字を失った。タイムカプセルは空で、手紙は文字化けしている。友情の記憶が消えつつある。'
                                : '20年前に一緒にタイムカプセルを埋めた親友。実は、あなたが知らない「もうひとつ」の手紙を入れていた。手紙の裏には何か書かれているかもしれない。'}
                              {scenarioResults[6] && !isDarkMode && (
                                <><br/><br/><span className="font-semibold text-yellow-700">謎の声との関係:</span> ひろがタイムカプセルに入れた「もうひとつ」の手紙は、謎の声からの導きでした。謎の声は、友情を通じて「もうひとつ」の価値を教えてくれた存在です。
                                </>)}
                              {scenarioResults[6] && isDarkMode && (
                                <><br/><br/><span className="font-semibold text-red-700">【バグ】:</span> ひろのデータは破損しています。「ひ」という文字が消失し、タイムカプセルの内容が空になっています。記憶の整合性が崩壊しています。
                                </>)}
                            </p>
                            <p className={`text-xs italic mb-3 ${isDarkMode ? 'text-red-700' : 'text-yellow-600'}`}>
                              {isDarkMode ? '「ひ...ひ...ひろ...」【エラー】' : '「実は、もうひとつ秘密があるんだ...」'}
                            </p>
                            {result && (
                              <>
                                <div className={`mt-3 pt-3 border-t ${isDarkMode ? 'border-red-600 bg-red-900' : 'border-yellow-200'}`}>
                                  <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-red-200' : 'text-yellow-700'}`}>後日談</p>
                                  <p className={`text-xs whitespace-pre-line ${isDarkMode ? 'text-red-100' : 'text-gray-600'}`}>
                                    {isDarkMode 
                                      ? '【データ破損】\nひろのデータは完全に崩壊しました。タイムカプセルは空で、手紙は文字化けしています。\n「ひ」という文字を失ったひろは、友情の記憶を失っています。\n記憶の整合性が崩壊し、修復不可能な状態です。'
                                      : result.epilogue}
                                  </p>
                                </div>
                                {result.hasWord && scenario && scenario.branches[result.choiceId] && scenario.branches[result.choiceId].epilogue2 && (
                                  <>
                                    <button
                                      onClick={() => {
                                        const newExpanded = new Set(expandedProfiles);
                                        if (isExpanded) {
                                          newExpanded.delete(3);
                                        } else {
                                          newExpanded.add(3);
                                        }
                                        setExpandedProfiles(newExpanded);
                                      }}
                                      className="mt-2 text-xs text-yellow-600 hover:text-yellow-800 underline"
                                    >
                                      {isExpanded ? '▼ 後日談の後日談を隠す' : '▶ 後日談の後日談を見る'}
                                    </button>
                                    {isExpanded && (
                                      <div className={`mt-2 pt-2 border-t ${isDarkMode ? 'border-red-700 bg-red-950' : 'border-yellow-100'}`}>
                                        <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-red-300' : 'text-yellow-600'}`}>後日談の後日談</p>
                                        <p className={`text-xs whitespace-pre-line ${isDarkMode ? 'text-red-200' : 'text-gray-600'}`}>
                                          {isDarkMode 
                                            ? '【完全崩壊】\nひろは完全にデータの欠片となって消えました。\nタイムカプセルは空で、手紙は文字化けしています。\n「ひ」という文字を失ったひろは、もう存在しません。\n記憶の整合性は完全に崩壊し、修復不可能です。\n\nあなたは、ひろを失った世界に一人取り残されました。'
                                            : scenario.branches[result.choiceId].epilogue2}
                                        </p>
                                      </div>
                                    )}
                                  </>
                                )}
                                {!result.hasWord && scenario && scenario.branches[result.choiceId] && scenario.branches[result.choiceId].hint && (
                                  <div className="mt-3 pt-3 border-t border-yellow-200 bg-yellow-50 rounded p-2">
                                    <p className="text-xs text-yellow-700 whitespace-pre-line">{scenario.branches[result.choiceId].hint}</p>
                                  </div>
                                )}
                              </>
                            )}
                          </>
                        ) : (
                          <p className="text-sm text-gray-500 italic">シナリオ「タイムカプセル」をクリアすると表示されます</p>
                        )}
                      </div>
                    );
                  })()}

                  {/* シナリオ4: と */}
                  {(() => {
                    const isUnlocked = scenarioResults[4] !== undefined;
                    const result = scenarioResults[4];
                    const scenario = scenarios.find(s => s.id === 4);
                    const isExpanded = expandedProfiles.has(4);
                    return (
                      <div className={`bg-gradient-to-br from-purple-50 to-indigo-50 rounded-lg p-4 border-2 ${isUnlocked ? 'border-purple-200' : 'border-gray-300'} relative ${!isUnlocked ? 'opacity-60' : ''}`}>
                        {!isUnlocked && (
                          <div className="absolute inset-0 bg-gray-200 bg-opacity-50 rounded-lg flex items-center justify-center backdrop-blur-sm">
                            <span className="text-gray-500 font-bold text-lg">???</span>
                          </div>
                        )}
                        <h3 className="font-bold text-lg text-gray-800 mb-2">
                          {isUnlocked ? '遠藤 とおる（試験官）' : '???（試験官）'}
                        </h3>
                        {isUnlocked ? (
                          <>
                            <p className={`text-sm mb-2 ${isDarkMode ? 'text-red-900' : 'text-gray-700'}`}>
                              <span className="font-semibold">職業:</span> {isDarkMode ? '【データ欠損】' : '魔法学校の試験官'}<br/>
                              <span className="font-semibold">特徴:</span> {isDarkMode 
                                ? 'バグによって「と」という文字を失った。ウサギは無限に増殖し、消すことができない。魔法の法則が崩壊している。'
                                : '厳格だが、予想外の結果にも柔軟に対応する。ウサギが2羽出現した時、「もうひとつ」消すよう指示。消えた跡には何かが残るかもしれない。'}
                              {scenarioResults[6] && !isDarkMode && (
                                <><br/><br/><span className="font-semibold text-purple-700">謎の声との関係:</span> とおる試験官の「もうひとつ」という指示は、謎の声からの試練でした。謎の声は、とおる試験官を通じて、成長のための「もうひとつ」の道を示していたのです。
                                </>)}
                              {scenarioResults[6] && isDarkMode && (
                                <><br/><br/><span className="font-semibold text-red-700">【バグ】:</span> とおるのデータは破損しています。「と」という文字が消失し、ウサギが無限増殖しています。シミュレーションの物理法則が完全に崩壊しています。
                                </>)}
                            </p>
                            <p className={`text-xs italic mb-3 ${isDarkMode ? 'text-red-700' : 'text-purple-600'}`}>
                              {isDarkMode ? '「と...と...とま...」【エラー】' : '「もうひとつ、試してみなさい」'}
                            </p>
                            {result && (
                              <>
                                <div className={`mt-3 pt-3 border-t ${isDarkMode ? 'border-red-600 bg-red-900' : 'border-purple-200'}`}>
                                  <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-red-200' : 'text-purple-700'}`}>後日談</p>
                                  <p className={`text-xs whitespace-pre-line ${isDarkMode ? 'text-red-100' : 'text-gray-600'}`}>
                                    {isDarkMode 
                                      ? '【データ破損】\nとおるのデータは完全に崩壊しました。ウサギは無限に増殖し、消すことができません。\n「と」という文字を失ったとおるは、魔法の法則を失っています。\nシミュレーションの物理法則が完全に崩壊しています。'
                                      : result.epilogue}
                                  </p>
                                </div>
                                {result.hasWord && scenario && scenario.branches[result.choiceId] && scenario.branches[result.choiceId].epilogue2 && (
                                  <>
                                    <button
                                      onClick={() => {
                                        const newExpanded = new Set(expandedProfiles);
                                        if (isExpanded) {
                                          newExpanded.delete(4);
                                        } else {
                                          newExpanded.add(4);
                                        }
                                        setExpandedProfiles(newExpanded);
                                      }}
                                      className="mt-2 text-xs text-purple-600 hover:text-purple-800 underline"
                                    >
                                      {isExpanded ? '▼ 後日談の後日談を隠す' : '▶ 後日談の後日談を見る'}
                                    </button>
                                    {isExpanded && (
                                      <div className={`mt-2 pt-2 border-t ${isDarkMode ? 'border-red-700 bg-red-950' : 'border-purple-100'}`}>
                                        <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-red-300' : 'text-purple-600'}`}>後日談の後日談</p>
                                        <p className={`text-xs whitespace-pre-line ${isDarkMode ? 'text-red-200' : 'text-gray-600'}`}>
                                          {isDarkMode 
                                            ? '【完全崩壊】\nとおるは完全にデータの欠片となって消えました。\nウサギは無限に増殖し、消すことができません。\n「と」という文字を失ったとおるは、もう存在しません。\nシミュレーションの物理法則は完全に崩壊し、修復不可能です。\n\nあなたは、とおるを失った世界に一人取り残されました。'
                                            : scenario.branches[result.choiceId].epilogue2}
                                        </p>
                                      </div>
                                    )}
                                  </>
                                )}
                                {!result.hasWord && scenario && scenario.branches[result.choiceId] && scenario.branches[result.choiceId].hint && (
                                  <div className="mt-3 pt-3 border-t border-purple-200 bg-purple-50 rounded p-2">
                                    <p className="text-xs text-purple-700 whitespace-pre-line">{scenario.branches[result.choiceId].hint}</p>
                                  </div>
                                )}
                              </>
                            )}
                          </>
                        ) : (
                          <p className="text-sm text-gray-500 italic">シナリオ「魔法学校の試験」をクリアすると表示されます</p>
                        )}
                      </div>
                    );
                  })()}

                  {/* シナリオ5: つ */}
                  {(() => {
                    const isUnlocked = scenarioResults[5] !== undefined;
                    const result = scenarioResults[5];
                    const scenario = scenarios.find(s => s.id === 5);
                    const isExpanded = expandedProfiles.has(5);
                    return (
                      <div className={`bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-4 border-2 ${isUnlocked ? 'border-green-200' : 'border-gray-300'} relative ${!isUnlocked ? 'opacity-60' : ''}`}>
                        {!isUnlocked && (
                          <div className="absolute inset-0 bg-gray-200 bg-opacity-50 rounded-lg flex items-center justify-center backdrop-blur-sm">
                            <span className="text-gray-500 font-bold text-lg">???</span>
                          </div>
                        )}
                        <h3 className="font-bold text-lg text-gray-800 mb-2">
                          {isUnlocked ? '月島 つばさ（恋人）' : '???（恋人）'}
                        </h3>
                        {isUnlocked ? (
                          <>
                            <p className={`text-sm mb-2 ${isDarkMode ? 'text-red-900' : 'text-gray-700'}`}>
                              <span className="font-semibold">職業:</span> {isDarkMode ? '【データ欠損】' : 'デザイナー'}<br/>
                              <span className="font-semibold">特徴:</span> {isDarkMode 
                                ? 'バグによって「つ」という文字を失った。パズルのピースは永遠に足りず、完成することはない。愛の記憶が消えつつある。'
                                : '優しく気配り上手。パズルが完成することを見越して、「もうひとつ」のパズルを用意していた。箱の蓋の内側に何かメッセージがあるかもしれない。'}
                              {scenarioResults[6] && !isDarkMode && (
                                <><br/><br/><span className="font-semibold text-green-700">謎の声との関係:</span> つばさが用意した「もうひとつ」のパズルは、謎の声からの贈り物でした。謎の声は、つばさを通じて、愛と気配りの「もうひとつ」を教えてくれた存在です。
                                </>)}
                              {scenarioResults[6] && isDarkMode && (
                                <><br/><br/><span className="font-semibold text-red-700">【バグ】:</span> つばさのデータは破損しています。「つ」という文字が消失し、パズルは永遠に完成しません。愛のデータが欠損しています。
                                </>)}
                            </p>
                            <p className={`text-xs italic mb-3 ${isDarkMode ? 'text-red-700' : 'text-green-600'}`}>
                              {isDarkMode ? '「つ...つ...つば...」【エラー】' : '「君のために、もうひとつ準備してたんだ」'}
                            </p>
                            {result && (
                              <>
                                <div className={`mt-3 pt-3 border-t ${isDarkMode ? 'border-red-600 bg-red-900' : 'border-green-200'}`}>
                                  <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-red-200' : 'text-green-700'}`}>後日談</p>
                                  <p className={`text-xs whitespace-pre-line ${isDarkMode ? 'text-red-100' : 'text-gray-600'}`}>
                                    {isDarkMode 
                                      ? '【データ破損】\nつばさのデータは完全に崩壊しました。パズルのピースは永遠に足りず、完成することはありません。\n「つ」という文字を失ったつばさは、愛の記憶を失っています。\n愛のデータが欠損し、修復不可能な状態です。'
                                      : result.epilogue}
                                  </p>
                                </div>
                                {result.hasWord && scenario && scenario.branches[result.choiceId] && scenario.branches[result.choiceId].epilogue2 && (
                                  <>
                                    <button
                                      onClick={() => {
                                        const newExpanded = new Set(expandedProfiles);
                                        if (isExpanded) {
                                          newExpanded.delete(5);
                                        } else {
                                          newExpanded.add(5);
                                        }
                                        setExpandedProfiles(newExpanded);
                                      }}
                                      className="mt-2 text-xs text-green-600 hover:text-green-800 underline"
                                    >
                                      {isExpanded ? '▼ 後日談の後日談を隠す' : '▶ 後日談の後日談を見る'}
                                    </button>
                                    {isExpanded && (
                                      <div className={`mt-2 pt-2 border-t ${isDarkMode ? 'border-red-700 bg-red-950' : 'border-green-100'}`}>
                                        <p className={`text-xs font-semibold mb-1 ${isDarkMode ? 'text-red-300' : 'text-green-600'}`}>後日談の後日談</p>
                                        <p className={`text-xs whitespace-pre-line ${isDarkMode ? 'text-red-200' : 'text-gray-600'}`}>
                                          {isDarkMode 
                                            ? '【完全崩壊】\nつばさは完全にデータの欠片となって消えました。\nパズルのピースは永遠に足りず、完成することはありません。\n「つ」という文字を失ったつばさは、もう存在しません。\n愛のデータは完全に欠損し、修復不可能です。\n\nあなたは、つばさを失った世界に一人取り残されました。'
                                            : scenario.branches[result.choiceId].epilogue2}
                                        </p>
                                      </div>
                                    )}
                                  </>
                                )}
                                {!result.hasWord && scenario && scenario.branches[result.choiceId] && scenario.branches[result.choiceId].hint && (
                                  <div className="mt-3 pt-3 border-t border-green-200 bg-green-50 rounded p-2">
                                    <p className="text-xs text-green-700 whitespace-pre-line">{scenario.branches[result.choiceId].hint}</p>
                                  </div>
                                )}
                              </>
                            )}
                          </>
                        ) : (
                          <p className="text-sm text-gray-500 italic">シナリオ「最後のピース」をクリアすると表示されます</p>
                        )}
                      </div>
                    );
                  })()}

                  {/* 謎の声（真実の扉クリア後） */}
                  {(() => {
                    const isUnlocked = scenarioResults[6] !== undefined;
                    const result = scenarioResults[6];
                    if (!isUnlocked) return null;
                    
                    return (
                      <div className="bg-gradient-to-br from-indigo-50 to-violet-50 rounded-lg p-4 border-2 border-indigo-200">
                        <h3 className="font-bold text-lg text-gray-800 mb-2">謎の声</h3>
                        <p className="text-sm text-gray-700 mb-2">
                          <span className="font-semibold">正体:</span> 真実の扉の守護者<br/>
                          <span className="font-semibold">特徴:</span> 5つの「もうひとつ」を集めた者に、真実を伝える存在。すべての登場人物との間に深い繋がりがある。
                        </p>
                        {result && (
                          <>
                            <div className="mt-3 pt-3 border-t border-indigo-200">
                              <p className="text-xs font-semibold text-indigo-700 mb-1">後日談</p>
                              <p className="text-xs text-gray-600 whitespace-pre-line">{result.epilogue}</p>
                            </div>
                          </>
                        )}
                      </div>
                    );
                  })()}
                </div>

                {/* エンドクレジットボタン（真実の扉クリア後） */}
                {scenarioResults[6] && (
                  <div className="mt-8 text-center">
                    <button
                      onClick={() => setShowCredits(true)}
                      className="bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-bold py-3 px-8 rounded-lg transition-all transform hover:scale-105 shadow-lg"
                    >
                      🎬 エンドクレジットを見る
                    </button>
                  </div>
                )}
                
                <div className="mt-6 text-center">
                  <button
                    onClick={() => setShowHint(!showHint)}
                    className="text-sm text-gray-500 hover:text-gray-700 underline italic transition-colors"
                  >
                    {showHint ? '▼ ヒントを隠す' : '▲ 何か見えそうな気がする...'}
                  </button>
                  {showHint && (
                    <div className="mt-4 p-4 bg-gray-100 rounded-lg border-l-4 border-gray-400">
                      <p className="text-sm text-gray-700">
                        <span className="font-semibold">💡 ヒント:</span> 各登場人物の名前には、特別な文字が隠されています。
                        プロフィールをよく読むと、どこに「もうひとつ」があるか分かるかもしれません...
                      </p>
                    </div>
                  )}
                </div>

                {/* 実績画面（全シナリオクリア後） */}
                {totalCompleted === scenarios.length && (
                  <div className="mt-12 pt-8 border-t-2 border-gray-300">
                    <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center">実績一覧</h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {/* シナリオ1-5のエンド */}
                      {scenarios.filter(s => s.id <= 5).map((scenario) => {
                        const result = scenarioResults[scenario.id];
                        // trueエンド: hasWordがtrueの選択肢
                        const trueChoiceId = scenario.choices.find(c => scenario.branches[c.id]?.hasWord)?.id;
                        // falseエンド: hasWordがfalseの選択肢
                        const falseChoiceId = scenario.choices.find(c => !scenario.branches[c.id]?.hasWord)?.id;
                        const trueEndSeen = result && result.hasWord && result.choiceId === trueChoiceId;
                        const falseEndSeen = result && !result.hasWord && result.choiceId === falseChoiceId;
                        
                        return (
                          <div key={scenario.id} className="bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-4 border-2 border-gray-300">
                            <h3 className="font-bold text-lg text-gray-800 mb-3">{scenario.title}</h3>
                            <div className="space-y-2">
                              <div className={`p-3 rounded ${trueEndSeen ? 'bg-green-50 border-2 border-green-400' : 'bg-gray-200 border-2 border-gray-400 opacity-50 blur-sm'}`}>
                                <p className={`text-sm font-semibold ${trueEndSeen ? 'text-green-800' : 'text-gray-500'}`}>
                                  ✨ Trueエンド
                                </p>
                                {trueEndSeen && (
                                  <p className="text-xs text-gray-600 mt-1">
                                    【もうひとつ】を獲得したエンド
                                  </p>
                                )}
                              </div>
                              <div className={`p-3 rounded ${falseEndSeen ? 'bg-red-50 border-2 border-red-400' : 'bg-gray-200 border-2 border-gray-400 opacity-50 blur-sm'}`}>
                                <p className={`text-sm font-semibold ${falseEndSeen ? 'text-red-800' : 'text-gray-500'}`}>
                                  ❌ Falseエンド
                                </p>
                                {falseEndSeen && (
                                  <p className="text-xs text-gray-600 mt-1">
                                    【もうひとつ】を獲得できなかったエンド
                                  </p>
                                )}
                              </div>
                            </div>
                          </div>
                        );
                      })}

                      {/* 真実の扉のエンド */}
                      {(() => {
                        const result = scenarioResults[6];
                        const wasDarkMode = result && result.scoreAtCompletion > scenarios.length;
                        const trueEndSeen = result && result.hasWord && result.choiceId === 2 && !wasDarkMode;
                        const falseEndSeen = result && !result.hasWord && result.choiceId === 1 && !wasDarkMode;
                        const darkModeEnd1Seen = result && wasDarkMode && result.choiceId === 1;
                        const darkModeEnd2Seen = result && wasDarkMode && result.choiceId === 2;
                        
                        return (
                          <div className="bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-4 border-2 border-gray-300">
                            <h3 className="font-bold text-lg text-gray-800 mb-3">真実の扉</h3>
                            <div className="space-y-2">
                              {/* 通常モードのエンド */}
                              <div className={`p-3 rounded ${trueEndSeen ? 'bg-green-50 border-2 border-green-400' : 'bg-gray-200 border-2 border-gray-400 opacity-50 blur-sm'}`}>
                                <p className={`text-sm font-semibold ${trueEndSeen ? 'text-green-800' : 'text-gray-500'}`}>
                                  ✨ Trueエンド
                                </p>
                                {trueEndSeen && (
                                  <p className="text-xs text-gray-600 mt-1">
                                    「答えを知りたかった」を選んだエンド
                                  </p>
                                )}
                              </div>
                              <div className={`p-3 rounded ${falseEndSeen ? 'bg-red-50 border-2 border-red-400' : 'bg-gray-200 border-2 border-gray-400 opacity-50 blur-sm'}`}>
                                <p className={`text-sm font-semibold ${falseEndSeen ? 'text-red-800' : 'text-gray-500'}`}>
                                  ❌ Falseエンド
                                </p>
                                {falseEndSeen && (
                                  <p className="text-xs text-gray-600 mt-1">
                                    「好奇心から」を選んだエンド
                                  </p>
                                )}
                              </div>
                              
                              {/* ダークモードのエンド */}
                              <div className={`p-3 rounded ${darkModeEnd1Seen ? 'bg-red-900 border-2 border-red-600' : 'bg-gray-200 border-2 border-gray-400 opacity-50 blur-sm'}`}>
                                <p className={`text-sm font-semibold ${darkModeEnd1Seen ? 'text-red-200' : 'text-gray-500'}`}>
                                  ⚠️ ダークエンド1
                                </p>
                                {darkModeEnd1Seen && (
                                  <p className="text-xs text-red-100 mt-1">
                                    「すみません...」と謝ったエンド
                                  </p>
                                )}
                              </div>
                              <div className={`p-3 rounded ${darkModeEnd2Seen ? 'bg-red-900 border-2 border-red-600' : 'bg-gray-200 border-2 border-gray-400 opacity-50 blur-sm'}`}>
                                <p className={`text-sm font-semibold ${darkModeEnd2Seen ? 'text-red-200' : 'text-gray-500'}`}>
                                  ⚠️ ダークエンド2
                                </p>
                                {darkModeEnd2Seen && (
                                  <p className="text-xs text-red-100 mt-1">
                                    「これは何ですか？」と問うたエンド
                                  </p>
                                )}
                              </div>
                            </div>
                          </div>
                        );
                      })()}
                    </div>
                    
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      // シナリオプレイ中
      const scenario = scenarios[currentScenario];
      const isDarkMode = currentScenario === scenarios.findIndex(s => s.id === 6) && score > scenarios.length;

      return (
        <div className={`min-h-screen flex items-center justify-center p-4 ${isDarkMode ? 'bg-gradient-to-br from-red-950 via-black to-gray-900' : 'bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900'}`}>
          <div className={`backdrop-blur rounded-2xl shadow-2xl p-8 max-w-2xl w-full ${isDarkMode ? 'bg-red-900/90 border-2 border-red-600' : 'bg-white/90'}`}>
            <div className="flex justify-between items-center mb-6">
              <h1 className={`text-2xl font-bold ${isDarkMode ? 'text-red-800' : 'text-gray-800'}`}>
                {isDarkMode ? '真実の扉【ダークモード】' : scenario.title}
              </h1>
              <div className="flex items-center gap-4">
                <div className="text-sm text-gray-600">
                  スコア: {score} / {scenarios.length}
                  {score > scenarios.length && <span className="text-red-500 font-bold ml-1">（おや？）</span>}
                </div>
                <button
                  onClick={backToSelection}
                  className="text-sm text-purple-600 hover:text-purple-800 underline"
                >
                  選択画面に戻る
                </button>
              </div>
            </div>

            {gameState === 'setup' && (
              <div className="space-y-6">
                <p className="text-lg text-gray-700 whitespace-pre-line leading-relaxed">
                  {scenario.setup}
                </p>
                <div className="space-y-3">
                  {(isDarkMode ? [
                    { id: 1, text: '「すみません...」と謝る', preview: '私：「壊してしまって...' },
                    { id: 2, text: '「これは何ですか？」と問う', preview: '私：「この世界は...' }
                  ] : scenario.choices).map((choice) => (
                    <button
                      key={choice.id}
                      onClick={() => handleChoice(choice.id)}
                      className={`w-full font-medium py-4 px-6 rounded-lg transition-all transform hover:scale-105 text-left ${
                        isDarkMode 
                          ? 'bg-gradient-to-r from-red-600 to-black hover:from-red-700 hover:to-gray-900 text-white border-2 border-red-400'
                          : 'bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white'
                      }`}
                    >
                      <div className="font-bold mb-1">選択肢{choice.id}：{choice.text}</div>
                      <div className={`text-sm opacity-80 ${isDarkMode ? 'text-red-100' : 'text-purple-100'}`}>
                        {choice.preview}
                      </div>
                    </button>
                  ))}
                </div>
              </div>
            )}

            {gameState === 'result' && (
              <div className="space-y-6">
                <div className={`rounded-lg p-6 ${isDarkMode ? 'bg-red-900 text-red-100 border-2 border-red-600' : 'bg-gray-50'}`}>
                  <p className={`whitespace-pre-line leading-relaxed ${isDarkMode ? 'text-red-100' : 'text-gray-700'}`}>
                    {isDarkMode 
                      ? (selectedChoice === 1 
                        ? '私：「すみません...壊してしまって...」\n\n壊れた声：「謝っても...もう遅い...」\n世界が歪み始める。\n\n壊れた声：「この世界は...シミュレーションだった...」\n「あなたの異常な行動が...世界を破壊した...」\n「もう...修復できない...」\n\n画面が歪み、文字が崩れていく。\nあなたは、自分が何をしてしまったのか理解した。'
                        : '私：「この世界は...何ですか？」\n\n壊れた声：「シミュレーション...すべてが...」\n「あなたは...バグを起こした...」\n「世界の整合性が...崩壊している...」\n\n周囲の空間が歪み、現実が崩れていく。\n登場人物たちの姿が、データの欠片となって消えていく。\n\n壊れた声：「もう...戻れない...」\n「あなたは...世界を壊した...」')
                      : scenario.branches[selectedChoice].text}
                  </p>
                </div>

                {!isDarkMode && (
                  <>
                    {scenario.branches[selectedChoice].hasWord ? (
                      <div className="bg-green-100 border-2 border-green-500 rounded-lg p-4 text-center">
                        <p className="text-green-800 font-bold text-xl">
                          ✨ 【もうひとつ】ワードゲット! ✨
                        </p>
                      </div>
                    ) : (
                      <div className="bg-red-100 border-2 border-red-500 rounded-lg p-4 text-center">
                        <p className="text-red-800 font-bold">
                          残念...【もうひとつ】は出ませんでした
                        </p>
                      </div>
                    )}
                  </>
                )}

                {isDarkMode && (
                  <div className="bg-red-900 border-2 border-red-600 rounded-lg p-4 text-center">
                    <p className="text-red-200 font-bold text-xl">
                      ⚠️ 【システムエラー】世界崩壊 ⚠️
                    </p>
                  </div>
                )}

                <div className={`border-l-4 p-4 ${isDarkMode ? 'bg-red-900 border-red-600' : 'bg-blue-50 border-blue-500'}`}>
                  <p className={`text-sm font-semibold mb-1 ${isDarkMode ? 'text-red-200' : 'text-blue-600'}`}>後日談</p>
                  <p className={`whitespace-pre-line ${isDarkMode ? 'text-red-100' : 'text-gray-700'}`}>
                    {isDarkMode
                      ? (selectedChoice === 1
                        ? '世界は完全に崩壊しました。\nシミュレーションの整合性は失われ、修復不可能な状態です。\n\n登場人物たちは、データの欠片となって消えていきました。\nもも子、うみ、ひろ、とおる、つばさ...\nすべてが、あなたの異常な行動の結果です。\n\nあなたは、空っぽの世界に一人取り残されました。\n「もう...戻れない...」\n\n【エンド：世界崩壊】'
                        : 'あなたは、世界の真実を知ってしまいました。\nこの世界は、シミュレーションだったのです。\n\nしかし、あなたの異常な行動が、世界を破壊してしまいました。\n登場人物たちは、バグによって歪んだ姿となっています。\n\nもも子は「も」という文字を失い、\nうみは「う」という文字を失い、\nひろは「ひ」という文字を失い、\nとおるは「と」という文字を失い、\nつばさは「つ」という文字を失いました。\n\n「もうひとつ」という言葉は、永遠に失われました。\n\n【エンド：言葉の消失】')
                      : (scenario.branches[selectedChoice].epilogue || scenario.epilogue)}
                  </p>
                </div>

                <button
                  onClick={backToSelection}
                  className="w-full bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-bold py-4 px-6 rounded-lg transition-all"
                >
                  シナリオ選択に戻る
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // アプリをレンダリング
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<MiniNovelGame />);
  </script>
</body>
</html>

